<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MSBuildCommunityTasksPath>$(MSBuildProjectDirectory)</MSBuildCommunityTasksPath>

    <MajorVersion>0</MajorVersion>
    <MinorVersion>0</MinorVersion>
    <BuildNumber>0</BuildNumber>
    <Revision>0</Revision>

    <Version>$(MajorVersion).$(MinorVersion).$(BuildNumber).0</Version>
    <FileVersion>$(MajorVersion).$(MinorVersion).$(BuildNumber).0</FileVersion>
    <InformationalVersion>$(MajorVersion).$(MinorVersion).$(BuildNumber).$(Revision)</InformationalVersion>
    <BuildFolder>../../../Build/</BuildFolder>
    <PackageFolder>../../../Packages/$(InformationalVersion)</PackageFolder>
  </PropertyGroup>

  <Import Project="$(MSBuildCommunityTasksPath)\MSBuild.Community.Tasks.targets"/>
  <Import Project="MSBuild.Extension.Pack.targets"/>
  <PropertyGroup Condition=" '$(BuildConfiguration)' == '' ">
    <BuildConfiguration>Release</BuildConfiguration>
  </PropertyGroup>

  <Target Name="Clean">
    <DeleteTree Directories="..\**\obj\**;..\**\bin\**;$(BuildFolder)" />
  </Target>

  <Target Name="Version">
    <Time>
      <Output TaskParameter="Year" PropertyName="Year" />
    </Time>

    <Message Text="Version: $(Version)"/>

    <Attrib Files="$(MSBuildProjectDirectory)\GlobalAssemblyInfo.cs" ReadOnly="False" />

    <AssemblyInfo CodeLanguage="CS"
                  OutputFile="$(MSBuildProjectDirectory)\..\GlobalAssemblyInfo.cs"
                  GenerateClass="true"
                  AssemblyCopyright="Copyright ï¿½ $(Year). All rights reserved."
                  AssemblyConfiguration="$(BuildConfiguration)"
                  AssemblyVersion="$(Version)"
                  AssemblyFileVersion="$(FileVersion)"
                  AssemblyInformationalVersion="$(InformationalVersion)" />
  </Target>

  <Target Name="Build" DependsOnTargets="Clean;Version">
    <MSBuild Projects="../WmMiddleware.sln" Properties="Configuration=$(BuildConfiguration)" />
    <ItemGroup>
      <WindowsServiceFiles
        Include="../Middleware.Scheduler.WindowService/bin/$(BuildConfiguration)/**/*.*">
      </WindowsServiceFiles>
      <ScriptFiles 
        Include="../Middleware.Scheduler.WindowService/*.bat">        
      </ScriptFiles>
    </ItemGroup> 
    <MakeDir Directories="$(BuildFolder);$(PackageFolder)"
             />
    <Copy SourceFiles="@(ScriptFiles)" DestinationFolder="$(BuildFolder)\$(InformationalVersion)"/>
    
    
    <MSBuild.ExtensionPack.Compression.Zip
    TaskAction="Create"
    CompressFiles="@(WindowsServiceFiles)"
    RemoveRoot="../Middleware.Scheduler.WindowService/bin/$(BuildConfiguration)/"
    ZipFileName="$(PackageFolder)WmMiddleware.Services.zip"/>
    <!--<Zip  
      ZipFileName="$(PackageFolder)WmMiddleware.Services.zip"
      WorkingDirectory="../Middleware.Scheduler.WindowService/bin/$(BuildConfiguration)/"
      Files="@(WindowsServiceFiles)" /> -->

  </Target>

</Project>